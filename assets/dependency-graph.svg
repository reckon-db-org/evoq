<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <!-- Title -->
  <text x="450" y="30" font-size="22" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    reckon-db-org Dependency Graph
  </text>
  <text x="450" y="55" font-size="14" text-anchor="middle" fill="#666">
    Event Sourcing Stack - Always consult before updating versions
  </text>

  <!-- Level 1: No dependencies -->
  <g id="level1">
    <!-- reckon-nifs -->
    <rect x="50" y="90" width="180" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
    <text x="140" y="115" font-size="16" font-weight="bold" text-anchor="middle" fill="#1976d2">
      reckon-nifs
    </text>
    <text x="140" y="135" font-size="12" text-anchor="middle" fill="#666">
      Rust NIFs
    </text>
    <text x="140" y="155" font-size="11" text-anchor="middle" fill="#666">
      No BEAM deps
    </text>

    <!-- reckon-gater -->
    <rect x="280" y="90" width="180" height="80" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="8"/>
    <text x="370" y="115" font-size="16" font-weight="bold" text-anchor="middle" fill="#7b1fa2">
      reckon-gater
    </text>
    <text x="370" y="135" font-size="12" text-anchor="middle" fill="#666">
      Gateway API
    </text>
    <text x="370" y="155" font-size="11" text-anchor="middle" fill="#666">
      No deps (types only)
    </text>

    <!-- evoq -->
    <rect x="510" y="90" width="180" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="8"/>
    <text x="600" y="115" font-size="16" font-weight="bold" text-anchor="middle" fill="#f57c00">
      evoq
    </text>
    <text x="600" y="135" font-size="12" text-anchor="middle" fill="#666">
      CQRS Framework
    </text>
    <text x="600" y="155" font-size="11" text-anchor="middle" fill="#666">
      No deps
    </text>
  </g>

  <!-- Arrow: reckon-gater to reckon-db -->
  <path d="M 370 170 L 370 230" stroke="#7b1fa2" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Level 2: Depends on Level 1 -->
  <g id="level2">
    <!-- reckon-db -->
    <rect x="280" y="240" width="180" height="90" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="8"/>
    <text x="370" y="265" font-size="16" font-weight="bold" text-anchor="middle" fill="#388e3c">
      reckon-db
    </text>
    <text x="370" y="285" font-size="12" text-anchor="middle" fill="#666">
      Event Store
    </text>
    <text x="370" y="305" font-size="11" text-anchor="middle" fill="#666">
      Depends on:
    </text>
    <text x="370" y="320" font-size="10" text-anchor="middle" fill="#666">
      reckon_gater, khepri, ra
    </text>
  </g>

  <!-- Arrows: reckon-gater and evoq to reckon-evoq -->
  <path d="M 370 330 L 370 380" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 170 Q 600 300, 490 380" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 370 330 Q 340 360, 320 380" stroke="#7b1fa2" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>

  <!-- Label for dashed line -->
  <text x="290" y="365" font-size="10" fill="#7b1fa2">
    via gater API
  </text>

  <!-- Level 3: reckon-evoq -->
  <g id="level3">
    <rect x="280" y="390" width="210" height="110" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="8"/>
    <text x="385" y="415" font-size="16" font-weight="bold" text-anchor="middle" fill="#c2185b">
      reckon-evoq
    </text>
    <text x="385" y="435" font-size="12" text-anchor="middle" fill="#666">
      Adapter
    </text>
    <text x="385" y="455" font-size="11" font-weight="bold" text-anchor="middle" fill="#c2185b">
      Depends on:
    </text>
    <text x="385" y="470" font-size="10" text-anchor="middle" fill="#388e3c">
      ✅ evoq
    </text>
    <text x="385" y="485" font-size="10" text-anchor="middle" fill="#7b1fa2">
      ✅ reckon_gater
    </text>
    <text x="385" y="500" font-size="10" text-anchor="middle" fill="#d32f2f">
      ❌ NOT reckon_db
    </text>
  </g>

  <!-- Arrow: reckon-evoq to Applications -->
  <path d="M 385 500 L 385 540" stroke="#c2185b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 370 330 L 230 540" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 600 170 Q 700 400, 540 540" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Level 4: Applications -->
  <g id="level4">
    <rect x="180" y="550" width="410" height="90" fill="#f5f5f5" stroke="#666" stroke-width="2" rx="8"/>
    <text x="385" y="575" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">
      Applications (e.g., macula-hecate)
    </text>
    <text x="385" y="595" font-size="11" text-anchor="middle" fill="#666">
      Depends on all three:
    </text>
    <text x="385" y="615" font-size="10" text-anchor="middle" fill="#666">
      reckon_db (storage) + evoq (framework) + reckon_evoq (adapter)
    </text>
  </g>

  <!-- Legend -->
  <g id="legend">
    <rect x="640" y="240" width="240" height="180" fill="#fafafa" stroke="#999" stroke-width="1" rx="4"/>
    <text x="760" y="265" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">
      Update Order
    </text>

    <text x="650" y="290" font-size="12" fill="#1976d2">1. reckon-nifs</text>
    <text x="670" y="305" font-size="10" fill="#666">(if NIFs change)</text>

    <text x="650" y="330" font-size="12" fill="#7b1fa2">2. reckon-gater</text>
    <text x="670" y="345" font-size="10" fill="#666">(if types change)</text>

    <text x="650" y="370" font-size="12" fill="#388e3c">3. reckon-db</text>
    <text x="740" y="370" font-size="12" fill="#f57c00">+ evoq</text>
    <text x="670" y="385" font-size="10" fill="#666">(parallel, no interdep)</text>

    <text x="650" y="410" font-size="12" fill="#c2185b">4. reckon-evoq</text>
    <text x="670" y="425" font-size="10" fill="#666">(after evoq/gater)</text>
  </g>

  <!-- Key Insight Box -->
  <rect x="50" y="550" width="100" height="90" fill="#fff9c4" stroke="#f57c00" stroke-width="2" rx="4"/>
  <text x="100" y="575" font-size="12" font-weight="bold" text-anchor="middle" fill="#f57c00">
    ⚠️ CRITICAL
  </text>
  <text x="100" y="595" font-size="9" text-anchor="middle" fill="#666">
    reckon_evoq
  </text>
  <text x="100" y="610" font-size="9" text-anchor="middle" fill="#666">
    does NOT
  </text>
  <text x="100" y="625" font-size="9" text-anchor="middle" fill="#666">
    depend on
  </text>
  <text x="100" y="640" font-size="9" font-weight="bold" text-anchor="middle" fill="#d32f2f">
    reckon_db!
  </text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
  </defs>
</svg>
